# TO BUILD: sudo singularity build egep.sif egep.sif.def

Bootstrap: docker
From: ubuntu:20.04

%labels
    Maintainer Ian M Bollinger <ian.bollinger@entheome.org>

%post
    # Set timezone to avoid interactive prompts
    export DEBIAN_FRONTEND=noninteractive
    ln -fs /usr/share/zoneinfo/UTC /etc/localtime

    # Update and install basic dependencies
    apt-get update && apt-get install -y \
        wget \
        curl \
        bzip2 \
        && apt-get clean

    # Install Miniconda
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p /opt/conda
    rm miniconda.sh
    /opt/conda/bin/conda init bash

    # Update PATH for Conda
    export PATH="/opt/conda/bin:$PATH"

    # Create a Conda environment for EGEP and install dependencies
    /bin/bash -c "conda create -c bioconda -c conda-forge -n EGEP_env --yes python>=3.10 \
                  mafft iqtree ete3 compleasm pandas biopython seaborn matplotlib"

%environment
    # Set PATH to include Conda environment
    export PATH="/opt/conda/envs/EGEP_env/bin:/opt/conda/bin:$PATH"

%runscript
    # Ensure the Conda environment is activated when running the container
    exec /bin/bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate EGEP_env && exec \"\$@\""
